![Build status](https://github.com/fletchmckee/ktjni/actions/workflows/build.yml/badge.svg)


# Ktjni

**Ktjni** is a Gradle plugin that generates JNI headers from Kotlin, Java, or Scala classes containing `external` (native) methods.  
This is especially useful when working with C/C++ native libraries in Kotlin Multiplatform or Android projects.

> [!WARNING]
> This plugin is in its alpha stage and should not be used in production releases. Header generation currently requires manual execution and does not yet integrate automatically with the build process.

## Usage

#### With Version Catalog (recommended)
```toml
[plugins]
ktjni-plugin = { id = "io.github.fletchmckee.ktjni", version = "0.0.1-alpha01" }
```
Then apply the plugin in your `build.gradle.kts`:
```gradle
plugins {
  alias(libs.plugins.ktjni)
}
```
#### Without Version Catalog
```gradle
plugins {
  id("io.github.fletchmckee.ktjni") version "0.0.1-alpha01"
}
```
And running the following command will generate JNI headers for any files containing native methods
```bash
./gradlew generateJniHeaders
```

## Example

Ktjni scans `.class` files using the [ASM](https://asm.ow2.io/) library. While different JVM languages produce `.class` files with varying metadata and compiler-specific attributes, they all compile native method declarations to the same core JVM method signature.

Whether your project uses:
#### Kotlin
```kotlin
package com.example

class Crypto {
  external fun sha256(input: ByteArray): ByteArray
}
```
#### Java
```java
package com.example;

public class Crypto {
    public native byte[] sha256(byte[] input);
}
```
#### Scala
```scala
package com.example

class Crypto {
  @native
  def sha256(input: Array[Byte]): Array[Byte]
}
```
The above examples would generate the same JNI header:
```c
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class com_example_Crypto */

#ifndef _Included_com_example_Crypto
#define _Included_com_example_Crypto
#ifdef __cplusplus
extern "C" {
#endif

/*
 * Class:     com_example_Crypto
 * Method:    sha256
 * Signature: ([B)[B
 */
JNIEXPORT jbyteArray JNICALL Java_com_example_Crypto_sha256
  (JNIEnv *, jobject, jbyteArray);

#ifdef __cplusplus
}
#endif
#endif

```

## Roadmap
> [!NOTE]
> The current alpha version requires manual header generation. The goal is to integrate this process automatically into the build lifecycle, so headers are generated during compilation without manual intervention. 
> This automatic integration is currently a work in progress.
